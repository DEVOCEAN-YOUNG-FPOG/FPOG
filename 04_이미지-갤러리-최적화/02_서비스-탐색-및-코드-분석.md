# 02. ì„œë¹„ìŠ¤ íƒìƒ‰ ë° ì½”ë“œ ë¶„ì„

> ë³¸ê²©ì ìœ¼ë¡œ ì½”ë“œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì„œë¹„ìŠ¤ë¥¼ ì‚´í´ë³¸ë‹¤.

## ğŸ“Œ 2.1 ì½”ë“œ ë‹¤ìš´ë¡œë“œ

```bash
$ git clone https://github.com/performance-lecture/lecture-4.git
```

## ğŸ“Œ 2.2 ì„œë¹„ìŠ¤ ì‹¤í–‰

```bash
# ëª¨ë“ˆ ì„¤ì¹˜ í›„ ì„œë¹„ìŠ¤ ì‹¤í–‰
$ npm install
$ npm run start

# ì•„ë˜ëŠ” ë¡œì»¬ ì„œë²„ ì‹¤í–‰ìš©
$ npm run server
```

> ì‘ì„±ìì˜ ì¶”ì‹  \_ node ë²„ì „ ì˜¤ë¥˜ë¡œì¸í•´ ì‹¤í–‰ì´ ì•ˆë˜ëŠ” ì´ìŠˆê°€ ìˆìŠµë‹ˆë‹¤.<br/>
> nvm use 16 ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ node ë²„ì „ ë³€ê²½ì´ í•„ìš”í• ë“¯í•´ìš”.

## ğŸ“Œ 2.3 ì„œë¹„ìŠ¤ íƒìƒ‰

![image](https://github.com/performance-lecture/lecture-4/assets/44965706/9357730c-7c7d-43a5-a552-59107e9dc66b)

- node ë²„ì „ ì´ìŠˆë¥¼ í•´ê²°í•˜ê³ , ì„œë¹„ìŠ¤ì™€ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë©´ ìœ„ì™€ ê°™ì€ í™”ë©´ì„ ë³¼ ìˆ˜ ìˆë‹¤.

![image](https://github.com/performance-lecture/lecture-4/assets/44965706/845fa2d5-acaf-4bdd-babb-96a9ea8c269b)

- ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ëª¨ë‹¬ì´ ë“±ì¥í•œë‹¤.
- í•˜ì§€ë§Œ ë‘ê°€ì§€ ë¬¸ì œì ì´ ì¡´ì¬í•œë‹¤.
  1. ì´ë¯¸ì§€ê°€ ë„ˆë¬´ ëŠ¦ê²Œ ë¡œë“œëœë‹¤.
  2. ì´ë¯¸ì§€ì— ë§ì¶˜ ë°°ê²½ ìƒ‰ì´ ë„ˆë¬´ ëŠë¦¬ê²Œ ì ìš©ëœë‹¤.

## ğŸ“Œ 2.4 ì½”ë“œ ë¶„ì„

### âœ… PhotoListContainer

```javascript
import React, { useEffect } from "react";
import { useDispatch, useSelector } from "react-redux";
import PhotoList from "../components/PhotoList";
import { fetchPhotos } from "../redux/photos";

function PhotoListContainer() {
  const dispatch = useDispatch();

  useEffect(() => {
    dispatch(fetchPhotos());
  }, [dispatch]);

  const { photos, loading } = useSelector((state) => ({
    photos:
      state.category.category === "all"
        ? state.photos.data
        : state.photos.data.filter(
            (photo) => photo.category === state.category.category
          ),
    loading: state.photos.loading,
  }));

  if (loading === "error") {
    return <span>Error!</span>;
  }

  if (loading !== "done") {
    return <span>loading...</span>;
  }

  return <PhotoList photos={photos} />;
}

export default PhotoListContainer;
```

- `useEffect`ë¥¼ í†µí•´ ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸ë¥¼ ì„œë²„ë¡œë¶€í„° ë°›ì•„ì˜¤ê³  ìˆë‹¤.
- ë°›ì•„ì˜¨ ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸ëŠ” *redux/photos.js*ì—ì„œ ê´€ë¦¬í•˜ë©°, `useSelector`ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³ ìˆë‹¤.
  - ì´ë¯¸ì§€ë¥¼ `filter`í•˜ì—¬ ì¹´í…Œê³ ë¦¬ì— ë§ëŠ” ì´ë¯¸ì§€ë§Œì„ ë Œë”ë§í•˜ê³  ìˆë‹¤.

### âœ… PhotoItem

```javascript
import React from "react";
import styled from "styled-components";
import { useDispatch } from "react-redux";
import { showModal } from "../redux/imageModal";

function PhotoItem({ photo: { urls, alt } }) {
  const dispatch = useDispatch();

  const openModal = () => {
    dispatch(showModal({ src: urls.full, alt }));
  };

  return (
    <ImageWrap>
      <Image
        src={urls.small + "&t=" + new Date().getTime()}
        alt={alt}
        onClick={openModal}
      />
    </ImageWrap>
  );
}

const ImageWrap = styled.div``;

const Image = styled.img`
  cursor: pointer;
  width: 100%;
`;

export default PhotoItem;
```

- ì„ íƒëœ í•˜ë‚˜ì˜ ì´ë¯¸ì§€ë¥¼ ê·¸ë ¤ë‚´ëŠ” ì»´í¬ë„ŒíŠ¸ì´ë‹¤.
- `showModal`ì˜ ë°˜í™˜ê°’ì„ `dispatch`ì—ê²Œ ì „ë‹¬í•œë‹¤.
  - Action ìƒì„±ìë¡œ, ë¦¬ë“€ì„œì—ê²Œ íŠ¹ì • ë™ì‘ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì •ë³´ë¥¼ ì „ë‹¬í•œë‹¤.

### âœ… imageModal ìŠ¤í† ì–´

```javascript
import { createSlice } from "@reduxjs/toolkit";

/** Actions **/
export const SHOW_MODAL = "SHOW_MODAL";
export const HIDE_MODAL = "HIDE_MODAL";
export const SET_BG_COLOR = "SET_BG_COLOR";

export const showModal = ({ src, alt }) => ({
  type: SHOW_MODAL,
  src,
  alt,
});
export const hideModal = () => ({ type: HIDE_MODAL });
export const setBgColor = (bgColor) => ({ type: SET_BG_COLOR, bgColor });

/** Reducer **/
const { reducer: imageModalReducer } = createSlice({
  name: "imageModal",
  initialState: {
    modalVisible: false,
    bgColor: { r: 0, g: 0, b: 0 },
    src: "",
    alt: "",
  },
  reducers: {},
  extraReducers: {
    SHOW_MODAL: (state, action) => {
      state.modalVisible = true;
      state.src = action.src;
      state.alt = action.alt;
      state.bgColor = { r: 0, g: 0, b: 0 };
    },
    HIDE_MODAL: (state) => {
      state.modalVisible = false;
    },
    SET_BG_COLOR: (state, action) => {
      state.bgColor = action.bgColor;
    },
  },
});

export default imageModalReducer;
```

- ë¦¬ë“€ì„œì™€ ì•¡ì…˜ ìƒì„±ìê°€ ì •ì˜ë˜ì–´ìˆë‹¤.
  - `ë¦¬ë“€ì„œ`ë€, ê´€ë¦¬í•˜ëŠ” ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
  - `ì•¡ì…˜`ì´ë€, ë¦¬ë•ìŠ¤ì—ì„œ ê´€ë¦¬í•˜ëŠ” í”Œë ˆì¸ ê°ì²´ì´ë‹¤.
  - `ì•¡ì…˜ ìƒì„±ì`ë€, ì•¡ì…˜ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
- `SHOW_MODAL`ì´ë¼ëŠ” ì´ë¦„ì˜ ì•¡ì…˜ì´ ë“¤ì–´ì™”ì„ ë•Œì˜ ë™ì‘ì´ ì •ì˜ë˜ì–´ìˆë‹¤.
  - `modalVisible`ì´ `true`ë¡œ ì—…ë°ì´íŠ¸ëœë‹¤.
  - ê´€ë¦¬ ì¤‘ì¸ ì´ì™¸ì˜ ìƒíƒœ ê°’ì´ ì—…ë°ì´íŠ¸ëœë‹¤.
    - ê°’ì´ ì—…ë°ì´íŠ¸ ë¨ì— ë”°ë¼, ëª¨ë‹¬ì´ í™”ë©´ì— ë“±ì¥í•œë‹¤.

### âœ… imageModal ì»´í¬ë„ŒíŠ¸

```javascript
import React from "react";
import styled from "styled-components";
import Modal from "./Modal";
import { useDispatch } from "react-redux";
import { hideModal, setBgColor } from "../redux/imageModal";
import { getAverageColorOfImage } from "../utils/getAverageColorOfImage";

function ImageModal({ modalVisible, src, alt, bgColor }) {
  const dispatch = useDispatch();
  const onLoadImage = (e) => {
    const averageColor = getAverageColorOfImage(e.target);
    dispatch(setBgColor(averageColor));
  };

  const closeModal = () => {
    dispatch(hideModal());
  };

  return (
    <Modal
      modalVisible={modalVisible}
      closeModal={closeModal}
      bgColor={bgColor}
    >
      <ImageWrap>
        <FullImage crossOrigin="*" src={src} alt={alt} onLoad={onLoadImage} />
      </ImageWrap>
    </Modal>
  );
}

const ImageWrap = styled.div`
  width: 100%;
  height: 100%;
`;
const FullImage = styled.img`
  max-width: 100vw;
  max-height: 75vh;
  box-shadow: 0px 0px 16px 4px rgba(0, 0, 0, 0.3);
`;

export default ImageModal;
```

- ì´ë¯¸ì§€ ëª¨ë‹¬ì„ ë„ìš°ëŠ” ì»´í¬ë„ŒíŠ¸ì´ë‹¤.
- `imageModalContainer`ì—ì„œ ì „ë‹¬í•˜ëŠ” prop ê°’ì„ í†µí•´ ëª¨ë‹¬ì˜ ìƒíƒœë¥¼ ë³€ê²½í•œë‹¤.
  - **ë¦¬ë•ìŠ¤ ìŠ¤í† ì–´ì˜ ìƒíƒœ ê°’ì„ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¨ë‹¤ëŠ” ëœ»ì´ë‹¤.**
- `getAverageColorOfImage`í•¨ìˆ˜ë¥¼ í†µí•´ ìƒ‰ìƒì´ ê³„ì‚°ëœë‹¤.
  - í•´ë‹¹ í•¨ìˆ˜ë¡œ ì¸í•´ì„œ ì´ë¯¸ì§€ê°€ ë Œë”ë§ë˜ê³  ë°°ê²½ ìƒ‰ì´ ê·¸ë ¤ì§„ë‹¤.

### âœ… getAverageColorOfImage í•¨ìˆ˜

```javascript
export function getAverageColorOfImage(imgElement) {
  const canvas = document.createElement("canvas");
  const context = canvas.getContext && canvas.getContext("2d");
  const averageColor = {
    r: 0,
    g: 0,
    b: 0,
  };

  if (!context) {
    return averageColor;
  }

  const width = (canvas.width =
    imgElement.naturalWidth || imgElement.offsetWidth || imgElement.width);
  const height = (canvas.height =
    imgElement.naturalHeight || imgElement.offsetHeight || imgElement.height);

  context.drawImage(imgElement, 0, 0);

  const imageData = context.getImageData(0, 0, width, height).data;
  const length = imageData.length;

  for (let i = 0; i < length; i += 4) {
    averageColor.r += imageData[i];
    averageColor.g += imageData[i + 1];
    averageColor.b += imageData[i + 2];
  }

  const count = length / 4;
  averageColor.r = ~~(averageColor.r / count); // ~~ => convert to int
  averageColor.g = ~~(averageColor.g / count);
  averageColor.b = ~~(averageColor.b / count);

  return averageColor;
}
```

- ìº”ë²„ìŠ¤ë¥¼ ì„¤ì •í•˜ê³ , ì´ë¯¸ì§€ë¥¼ ë‚´ë¶€ì— ê·¸ë ¤ì„œ í”½ì…€ ê°’ì˜ í‰ê· ì„ êµ¬í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
