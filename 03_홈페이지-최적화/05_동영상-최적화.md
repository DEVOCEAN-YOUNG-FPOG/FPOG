# 05. 동영상 최적화

## 📌5.1 동영상 콘텐츠 분석

홈페이지에서 사용된 동영상을 최적화해본다.
아래는 Network 패널에서 동영상이 다운로드 되는 과정이다.

<img width="551" alt="image" src="https://github.com/DEVOCEAN-YOUNG-FPOG/FPOG/assets/117897253/a950b6c4-d7e4-42eb-a489-35d42f89d3b8">

Network 패널 기록에서 볼 수 있듯, 동영상 파일은 이미지처럼 하나의 요청으로 처리하지 않고, 당장 재생이 필요한 앞부분을 먼저 다운로드 한뒤 순차적으로 나머지 내용을 다운로드한다. 따라서 동영상 콘텐츠의 다운로드 요청이 여러 개로 나뉘어진다.

하지만, 아무리 여러 번 나눠서 다운로드를 해도 동영상 파일이 크다보니, 재생하기까지의 시간이 꽤 오래 걸린다.

또한, Performace패널을 통해 확인해 보면 일정 시간동안 동영상 콘텐츠가 다운로드 되고 나서야 재생이 되는 것을 알 수 있다.

따라서, 우리는 이 동영상 콘텐츠를 최적화하여 더욱 빠르게 재생되도록 만들어보는 것을 목표로 한다.

## 📌5.2 동영상 압축

동영상 최적화는 이미지 최적화와 유사하다.
동영상의 가로와 세로 사이즈를 줄이고, 압축 방식을 변경하여 동영상의 용량을 줄인다. 이 곳에서는 단순하게 동영상을 압축하는 툴을 활용하여 최적화할 예정이다.

- 주의해야 할 점 : 지금 하려는 최적화 작업, 즉 동영상을 더 작은 사이즈로 압축하는 작업은 동영상의 화질을 낮추는 작업이다. 그렇기에 동영상이 서비스의 메인 콘텐츠라면 이 작업을 추천하지 않는다.

이번 실습에서 우리는 다양한 **Media.io**라는 서비스를 이용한다.
Link: <https://www.media.io/video-converter.html>

우리가 설정할 것은 다음과 같다.
우선, 파일 확장자를 WebM으로 선택한다. (웹에 최적화된 동영상 포맷)  
그 후 우리는 Bitrate와 Audio 이 두 가지 설정만 수정한다.
Bitrate는 제일 낮은 512Kbps로 설정하고, Audio는 체크 해제한다.

<img width="467" alt="image" src="https://github.com/DEVOCEAN-YOUNG-FPOG/FPOG/assets/117897253/07d2d750-e5bd-41a8-a8ec-8caffb146224">

설정이 완료되었다면 변환(convert) 버튼을 누르고 다운로드 한다. 결과적으로 다운로드된 동영상을 확인 해보면 용량이 원본의 1/5인 12MB가 된 걸 확인해 볼 수 있다.

### 🗯️Bitrate란❓

> 특정한 시간 단위마다 처리하는 비트의 수로 동영상에서는 1초에 얼마나 많은 정보를 포함하는가를 의미한다.
> 따라서 이 값이 크면 1초에 더 많은 정보를 포함하게 되므로 화질은 좋아지지만 파일의 사이즈는 커진다.

## 📌5.3 압축된 동영상 적용

압축된 동영상은 이미지 최적화에서 했던 것과 같이 **파일 이름에 언더바(\_)를 붙여 assets 폴더**로 옮겨준다. 그 후, 동영상을 렌더링하는 BannerVideo 컴포넌트에서 파일을 교체한다.

여기서 잊으면 안되는 것은 **호환성**이다.
WebM 파일을 지원하지 않는 브라우저를 위해 다음과 같이 video 태그를 사용하여 코드를 작성한다.

```javascript
import video from "../assets/banner-video.mp4";
import video_webm from "../assets/_banner-video.webm";

<video className="생략" autoPlay loop muted>
  <source src={video_webm} type="video/webm" />
  <source src={video} type="video/mp4" />
</video>;
```

이와 같이 작성하면, WebM동영상을 지원하지 않는 브라우저에서는 그 다음 소스인 MP4동영상을 재생할 수 있다.

_~~MP4 동영상도 압축하여 적용할 수 있지만, 확장자만 mp4로 적용하는 동일한 작업이므로 생략한다.~~_

## 📌5.4 최적화 전후 비교

최적화 후 Performance패널로 분석해보면, 동영상이 이전과 달리 매우 빠르게 로드되고 재생되는 것을 확인할 수 있다. 또한, 사이트에서 직접 새로고침을 해서 눈으로 확인해 봐도 큰 끊김 없이 영상이 로드되고 재생되는 것을 볼 수 있다.

## 📌5.5 팁

동영상 압축 후, 전보다 빠르게 로드되고 있긴 하지만 화질이 많이 저하된다.
동영상 압축이 필요로하면서 저하된 화질을 보완할 수 있는 방법에는 **패턴**과 **필터**를 이용하는 방법이 있다.

동영상 위에 패턴을 넣거나 동영상에 필터를 씌우게 되면, 패턴이나 필터에 가려져서 사용자는 동영상의 화질이 좋지 않음을 쉽게 인지할 수 없다.

_~~현재 페이지의 동영상도 마찬가지로, 무수히 많은 점이 찍혀있는 패턴이 적용되어있다!~~_
<img width="305" alt="image" src="https://github.com/DEVOCEAN-YOUNG-FPOG/FPOG/assets/117897253/1a3482b4-c8dc-4a4f-8c0d-5eadc0830836">

패턴만으로 충분하지 않다면 **필터**를 적용할 수 있다.
다양한 필터 중에서도, 가장 효과적인 것은 **blur**이다.  
video요소에 CSS코드로 **filter: blur(10px**) 를 넣어주면 동영상이 흐려진다.
굳이 동영상을 있는 그대로 보여 줄 필요가 없거나 배경으로만 가볍게 사용할 때 효과적이다.
