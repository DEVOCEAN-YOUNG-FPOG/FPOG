# 06. 이미지 사전 로딩

## 📌 6.1 느린 이미지 로딩

<img width="1050" alt="Screenshot 2023-06-06 at 22 24 13" src="https://github.com/whateveriiwant/whateveriiwant/assets/80333011/21b38e05-2cde-40f0-98a7-2800f805882a">

> 위 현상은 **Network** 패널에서 **throttling** 을 걸고 **disable cache** 옵션에 체크하여 캐시를 비활성화 하고 로딩한 결과이다.
>
> 이 같은 현상은 이미지가 제때 뜨지 않아 생기는 현상이다.

모달을 띄우고 그 안에 이미지를 로드하려고 하는데, 이미지의 사이즈가 크다 보니 시간이 지연되어 다운로드가 완료될 때 까지 아무것도 뜨지 않는 것이다.

이를 해결하기 위해 이미지를 **미리 다운로드**하는 기법인 **이미지 사전 로딩** 기법을 적용한다.

## 📌 6.2 이미지 사전 로딩

컴포넌트는 `import` 함수를 이용해 로드한다.  
반면 이미지는 이미지가 화면에 그려지는 시점, 즉 HTML/CSS에서 **이미지를 사용하는 시점**에 로드된다.

`Image` 객체를 사용해 JavaScript로 이미지를 직접 로드하는 방법이 있다.  
`Image` 객체는 다음과 같이 `new` 연산자를 이용해 생성한다.  
그런 다음 생성된 인스턴스의 `src` 속성에 원하는 이미지의 주소를 입력하면 해당 이미지를 로드할 수 있다.

```javascript
const img = new Image();
img.src = "{이미지 주소}";
```

### 📎 테스트

직접 브라우저의 콘솔 창에 테스트해 볼 수 있다.

개발자 도구의 **Network** 패널과 **Console** 패널을 동시에 열고 콘솔 창에 위 코드를 입력하면 코드가 입력된 순간 **Network** 패널에서 해당 이미지가 다운로드 되는 것을 볼 수 있다.

<img width="816" alt="image" src="https://github.com/whateveriiwant/whateveriiwant/assets/80333011/871c094f-0762-4522-b571-514ab13c159e">

### 📎 실제로 적용해보자

여기서 사전 로드할 이미지는 모달에서 가장 먼저 보이는 이미지로 넣어 줄 것이다.  
해당 이미지 주소는 `ImageModal.js` 파일에서 찾을 수 있다.

```javascript
useEffect(() => {
  const component = import("./components/ImageModal");

  const img = new Image();
  img.src =
    "https://stillmed.olympic.org/media/Photos/2016/08/20/part-1/20-08-2016-Football-Men-01.jpg?interpolation=lanczos-none&resize=*:800";
}, []);
```

<img width="734" alt="Screenshot 2023-06-06 at 22 44 45" src="https://github.com/whateveriiwant/whateveriiwant/assets/80333011/a50309ad-b3a1-4e55-b396-f22223373e07">

모달 코드와 함께 이미지가 다운로드되는 것을 볼 수 있다.  
즉, 나중에 모달 위에 표시될 대표 이미지를 미리 다운로드 한 것이다.

다음으로 모달을 클릭해 볼 차례이다.

> 🚨 주의  
> **Disable cache** 옵션을 해제한다.
>
> 이미지 사전 로딩이 가능한 이유는 브라우저가 해당 이미지를 캐싱해두기 때문이다.  
> 그러나 이 옵션이 체크돼있으면 캐싱을 하지 않아 매번 새로 불러온다.
>
> 하지만 캐시를 활성화하면 다른 리소스도 캐시를 사용해서 정확한 분석이 어려워질 수 있다.
>
> 따라서 다음 단계를 수행한다.
>
> 1. 개발자 도구를 연다.
> 2. 마우스 오른쪽 버튼으로 새로고침 버튼을 클릭한다.
> 3. **캐시 비우기 및 강력 새로고침**을 클릭한다.

위 단계를 수행 후 모달을 열면 대표 이미지가 바로 보이는 것을 확인할 수 있다.

### 🤔 고민

> 몇 장의 이미지까지 사전 로드 해 둘 것인가

모달의 첫 화면으로 보이는 이미지는 대표 이미지뿐만 아니라 하단 썸네일 이미지도 있다.

썸네일 이미지까지 사전 로딩을 할 수도 있지만 그렇게 되면 불필요하게 리소스를 사용하게 된다.  
이는 성능 문제를 야기한다.

따라서 어떤 콘텐츠를 사전 로드할 때는 정말 사전 로딩이 필요한지 고민해야 한다.

이번 실습에서는 첫 대표 이미지 한 장만 사전 로드했고 그 외 썸네일 이미지는 중요하지 않다고 생각하여 사전 로드하지 않았다.
